# R code {#r-code}

Everyone has their own coding style and formats.
There are however some best practice guidelines that
[_Bioconductor_](https://bioconductor.org/) reviewers will look for (see
[coding style] section below)

There are also some other key points, detailed in the following sections.

## License

Only contain code that can be distributed under the license specified (see also [The DESCRIPTION file](description.html#license)).

## `R CMD check` and `BiocCheck`

Many common coding and sytax issues are flagged in `R CMD check` and `BiocCheck()` (see the `R CMD check` [cheatsheet](http://r-pkgs.had.co.nz/check.html) and `r BiocStyle::Biocpkg("BiocCheck", vignette = "BiocCheck.html")` vignette.

Some of the more prominent offenders:

* Use `vapply()` instead of `sapply()`, and use the various `apply` functions instead of `for` loops.
* Use `seq_len()` or `seq_along()` instead of `1:...`.
* Use `TRUE` and `FALSE` instead of `T` and `F`.
* Use of numeric indices (rather than robust named indices).
* Use `is()` instead of `class() ==` and `class() !=`.
* Use `system2()` instead of `system()`.
* Do not use `set.seed()` in any internal <i class="fab fa-r-project"></i> code.
* Do not use `browser()` in any internal <i class="fab fa-r-project"></i> code.
* Avoid the use of `<<-`.
* Avoid use of direct slot access with `@` or `slot()`.
  Accessor methods should be created and utilized
* Use the packages `r BiocStyle::Biocpkg("ExperimentHub")` and `r BiocStyle::Biocpkg("AnnotationHub")` instead of downloading external data from unsanctioned providers such as <i class="fab fa-github"></i> GitHub, <i class="fa fa-dropbox" aria-hidden="true"></i> Dropbox, etc.
* Use `<-` instead of `=` for assigning variables.

### Formatting and syntax

* Function names should be `camelCase` or utilize the underscore `_` and not
have a dot `.` (which indicates S3 dispatch).
* Use `dev.new()` to start a graphics drive if necessary. Avoid using `x11()`
or `X11()`, for it can only be called on machines that have access to an X
server.
* Use the functions `message()`, `warning()` and `error()`, instead of the
`cat()` function (except for customized `show()` methods). `paste0()` should
generally not be used in these methods except for collapsing multiple values
from a variable.

### Re-use of functionality, classes, and generics

Avoid re-implementing functionality or classes (see also
[The DESCRIPTION file](description.html#depends-imports-suggests-enhances)).
Make use of appropriate existing packages (e.g.,
`r BiocStyle::Biocpkg("biomaRt")`,
`r BiocStyle::Biocpkg("AnnotationDbi")`,
`r BiocStyle::Biocpkg("Biostrings")`,
`r BiocStyle::Biocpkg("GenomicRanges")`) and classes (e.g.,
`r BiocStyle::Biocpkg("SummarizedExperiment")`,
`r BiocStyle::Biocpkg("AnnotatedDataFrame")`,
`r BiocStyle::Biocpkg("GRanges")`,
`r BiocStyle::Biocpkg("DNAStringSet")`) to avoid duplication of functionality
available in other [_Bioconductor_](https://bioconductor.org/) packages.
See also [Common Bioconductor Methods and Classes](https://bioconductor.org/developers/how-to/commonMethodsAndClasses/).

This encourages interoperability and simplifies your own package development.
If a new representation is needed, see the [Essential S4 interface](https://bioconductor.org/developers/how-to/efficient-code/#essential-s4-interface) section of [Robust and Efficient Code](https://bioconductor.org/developers/how-to/efficient-code).
In general, [_Bioconductor_](https://bioconductor.org/) will insist on interoperability with [Common Classes](https://bioconductor.org/developers/how-to/commonMethodsAndClasses/) for acceptance.

Developers should make an effort to re-use generics that fit the generic
contract for the proposed class-method pair i.e., the behavior of the method
aligns with the originally proposed behavior of the generic. Specifically,
the behavior can be one where the return value is of the same class across
methods. The method behavior can also be a performant conceptual transformation
or procedure across classes as described by the generic.
`r BiocStyle::Biocpkg("BiocGenerics")` lists commonly used generics in
Bioconductor. One example of a generic and method implementation is that of the
`rowSums` generic and the corresponding method within the
`r BiocStyle::Biocpkg("DelayedArray")` package. This generic contract returns a
numeric vector of the same length as the rows and is adhered to across classes
including the `DelayedMatrix` class. Re-using generics reduces the amount of
new generics by consolidating existing operations and avoids the mistake of
introducing a "new" generic with the same name. Generic name collisions may
mask or be masked by previous definitions in ways that are hard to diagnose.

### Methods development

We encourage maintainers to only create new methods for classes exported within
their packages. We discourage the generation of methods for external classes,
i.e., classes outside of the package [`NAMESPACE`](#namespace). This can
potentially cause method name collisions (i.e., where two methods defined on
the same object but in different packages) and pollute the methods environment
for those external classes. New methods for established classes can also cause
confusion among users given that the new method and class definition are in
separate packages.

### Functional programming

Avoid large chunks of repeated code. If code is being repeated this is
generally a good indication a helper function could be implemented.

### Function length

Excessively long functions should also be avoided. Write small functions.

It is best if each function has only one job that it needs to do. And it is
also best if that function does that job in as few lines of code as possible.
If you find yourself writing great long functions that extend for more than a
screen, then you should probably take a moment to split it up into smaller
helper functions.

Smaller functions are easier to read, debug and to reuse.

### Function arguments

Argument names to functions should be descriptive and well documented.
Arguments should generally have default values. Check arguments against a
validity check.

### Vectorization

Vectorize!

Many R operations are performed on the whole object, not just the elements of
the object (e.g., `sum(x)` instead of `x[1] + x[2] + x[2] + ...`). In
particular, relatively few situations require an explicit `for` loop.
See the [Vectorize](https://bioconductor.org/developers/how-to/efficient-code/#vectorize)
section of [Robust and Efficient Code for additional detail](https://bioconductor.org/developers/how-to/efficient-code).


### Parallelisation

For parallel implementation please use `r BiocStyle::Biocpkg("BiocParallel")`.
See also the [Parallel Recommendations](https://bioconductor.org/developers/how-to/efficient-code/#parallel-recommendations) section of [Robust and Efficient Code](https://bioconductor.org/developers/how-to/efficient-code).

A minimal number of cores (1 or 2) should be set as a default.

### Web Querying and File caching

Files downloaded should be cached.
Please use `r BiocStyle::Biocpkg("BiocFileCache")`.
If a maintainer creates their own caching directory, it should utilize standard
caching directories `tools::R_user_dir(package, which="cache")`. It is not
allowed to download or write any files to a users home directory or working
directory. Files should be cached as stated above with `BiocFileCache` (preferred)
or `R_user_dir` or `tempdir()/tempfile()` if files should not be persistent.

Please also follow guiding principles on [Querying Web
Resources](http://bioconductor.org/developers/how-to/web-query/), if applicable.

### Additional files and dependencies

Do NOT install anything on a users system.

System dependencies, applications, and additionally needed packages should be
assumed already present on the user's system.

If necessary, package maintainers should provide instructions for download and
setup, but should not execute those instructions on behalf of a user.

## Coding Style

Using similar coding style helps people understand code.  These
guidelines are preferences and strongly encouraged.

### Indentation

* Use 4 spaces for indenting.  No tabs.
* No lines longer than 80 characters.

### Variable names

* Use camelCase: initial lowercase, then alternate case between words.

### Function names

* Use camelCase: initial lower case, then alternate case between words.
* Do not use '.' (in the S3 class system, `some(x)` where `x` is class
  `A` will dispatch to `some.A`).
* Prefix non-exported functions with a '.'.

### Class names

* Use CamelCaps: initial upper case, then alternate case between
  words.

### File names

* Filename extension for R code should be '.R'. Use the prefix
  'methods-' for S4 class methods, e.g., 'methods-coverage.R'. Generic
  definitions can be listed in a single file, 'AllGenerics.R', and
  class definitions in 'AllClasses.R'.
* Filename extension for man pages should be '.Rd'.

### Use of space

* Always use space after a comma.  This: `a, b, c`.
* No space around "=" when using named arguments to functions. This:
  `somefunc(a=1, b=2)`
* Space around all binary operators: `a == b`.

### Comments

* Use "##" to start full-line comments.
* Indent at the same level as surrounding code.

### Namespaces

* Import all symbols used from packages other than "base". Except for
  default packages (base, graphics, stats, etc.) or when overly
  tedious, fully enumerate imports.
* Export all symbols useful to end users. Fully enumerate exports.


### End-User messages

* `message()` communicates diagnostic messages (e.g., progress during
  lengthy computations) during code evaluation.
* `warning()` communicates unusual situations handled by your code.
* `stop()` indicates an error condition.
* `cat()` or `print()` are used only when displaying an object to the
  user, e.g., in a `show` method.

### Misc

* Use `<-` not `=` for assignment.

#### Additonal references

* [Hadley Wickhams's R Style Guide](https://style.tidyverse.org/).

* [formatR](https://cran.r-project.org/web/packages/formatR/index.html) a
  package that assists with formatting.

